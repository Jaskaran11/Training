
attendance=# create table Employee(
attendance(# employee_ID int primary key,
attendance(# name varchar(55) not null,
attendance(# gender varchar(10) not null,
attendance(# age int not null,
attendance(# mobile int,
attendance(# email varchar(55) not null
attendance(# );
CREATE TABLE
attendance=# \d
          List of relations
 Schema |   Name   | Type  |  Owner
--------+----------+-------+----------
 public | employee | table | postgres
(1 row)


attendance=# create table Department(
attendance(# dept_ID serial primary key,
attendance(# department_name varchar(20) not null
attendance(# );
CREATE TABLE


attendance=# create table Job_Title(
attendance(# job_ID serial primary key,
attendance(# job_title varchar(30) not null,
attendance(# dept_id int,
attendance(# FOREIGN KEY (dept_id) REFERENCES Department(dept_ID)
attendance(# );
CREATE TABLE
attendance=# \d Job_Title
                                       Table "public.job_title"
  Column   |         Type          | Collation | Nullable |                  Default
-----------+-----------------------+-----------+----------+-------------------------------------------
 job_id    | integer               |           | not null | nextval('job_title_job_id_seq'::regclass)
 job_title | character varying(30) |           | not null |
 dept_id   | integer               |           |          |
Indexes:
    "job_title_pkey" PRIMARY KEY, btree (job_id)
Foreign-key constraints:
    "job_title_dept_id_fkey" FOREIGN KEY (dept_id) REFERENCES department(dept_id)

        ^
attendance=# create table Leave(
attendance(# leave_ID int primary key,
attendance(# employee_ID int not null,
attendance(# job_ID int not null,
attendance(# Date date not null,
attendance(# FOREIGN KEY (employee_ID) REFERENCES Employee(employee_ID),
attendance(# FOREIGN KEY (job_ID) REFERENCES Job_Title(job_ID)
attendance(# );
CREATE TABLE
attendance=# \d Leave
                  Table "public.leave"
   Column    |  Type   | Collation | Nullable | Default
-------------+---------+-----------+----------+---------
 leave_id    | integer |           | not null |
 employee_id | integer |           | not null |
 job_id      | integer |           | not null |
 date        | date    |           | not null |
Indexes:
    "leave_pkey" PRIMARY KEY, btree (leave_id)
Foreign-key constraints:
    "leave_employee_id_fkey" FOREIGN KEY (employee_id) REFERENCES employee(employee_id)
    "leave_job_id_fkey" FOREIGN KEY (job_id) REFERENCES job_title(job_id)

attendance=# create table Duty_Duration(
attendance(# duty_ID int primary key not null,
attendance(# employee_ID int not null,
attendance(# job_ID int not null,
attendance(# start_at TIME NOT NULL,
attendance(# end_at TIME NOT NULL,
attendance(# Date date not null,
attendance(# FOREIGN KEY (employee_ID) REFERENCES Employee(employee_ID),
attendance(# FOREIGN KEY (job_ID) REFERENCES Job_Title(job_ID)
attendance(# );
CREATE TABLE
attendance=# \d Duty_Duration
                     Table "public.duty_duration"
   Column    |          Type          | Collation | Nullable | Default
-------------+------------------------+-----------+----------+---------
 duty_id     | integer                |           | not null |
 employee_id | integer                |           | not null |
 job_id      | integer                |           | not null |
 start_at    | time without time zone |           | not null |
 end_at      | time without time zone |           | not null |
 date        | date                   |           | not null |
Indexes:
    "duty_duration_pkey" PRIMARY KEY, btree (duty_id)
Foreign-key constraints:
    "duty_duration_employee_id_fkey" FOREIGN KEY (employee_id) REFERENCES employee(employee_id)
    "duty_duration_job_id_fkey" FOREIGN KEY (job_id) REFERENCES job_title(job_id)


attendance=# create table Attendance_Reports(
attendance(# reprt_ID int primary key not null,
attendance(# employee_ID int not null,
attendance(# duty_ID int not null,
attendance(# job_ID int not null,
attendance(# leave_ID int not null,
attendance(# Date date not null,
attendance(# FOREIGN KEY (employee_ID) REFERENCES Employee(employee_ID),
attendance(# FOREIGN KEY (duty_ID) REFERENCES Duty_Duration(duty_ID),
attendance(# FOREIGN KEY (job_ID) REFERENCES Job_Title(job_ID),
attendance(# FOREIGN KEY (leave_ID) REFERENCES Leave(leave_ID)
attendance(# );
CREATE TABLE
attendance=# \d Attendance_Reports
           Table "public.attendance_reports"
   Column    |  Type   | Collation | Nullable | Default
-------------+---------+-----------+----------+---------
 reprt_id    | integer |           | not null |
 employee_id | integer |           | not null |
 duty_id     | integer |           | not null |
 job_id      | integer |           | not null |
 leave_id    | integer |           | not null |
 date        | date    |           | not null |
Indexes:
    "attendance_reports_pkey" PRIMARY KEY, btree (reprt_id)
Foreign-key constraints:
    "attendance_reports_duty_id_fkey" FOREIGN KEY (duty_id) REFERENCES duty_duration(duty_id)
    "attendance_reports_employee_id_fkey" FOREIGN KEY (employee_id) REFERENCES employee(employee_id)
    "attendance_reports_job_id_fkey" FOREIGN KEY (job_id) REFERENCES job_title(job_id)
    "attendance_reports_leave_id_fkey" FOREIGN KEY (leave_id) REFERENCES leave(leave_id)



attendance=# insert into Employee
attendance-# values(1,'Joe Stark','Male',33,98776262,'joe@gmail.com');
INSERT 0 1
attendance=# select * from Employee;
 employee_id |   name    | gender | age |  mobile  |     email
-------------+-----------+--------+-----+----------+---------------
           1 | Joe Stark | Male   |  33 | 98776262 | joe@gmail.com
(1 row)


attendance=# update Employee set mobile=1234567891 where employee_id=1;
UPDATE 1
attendance=# select * from Employee;
 employee_id |   name    | gender | age |   mobile   |     email
-------------+-----------+--------+-----+------------+---------------
           1 | Joe Stark | Male   |  33 | 1234567891 | joe@gmail.com
(1 row)



attendance=# insert into employee
attendance-# values(3,'Sasha Calle','Female',23,1209657387,'scalle@gmail.com'),
attendance-# (4,'Clark Kent','Male',35,2376890876,'clarkk@yahoo.com'),
attendance-# (5,'Lisa Ray','Female',55,1232345678,'ray@yahoo.com');
ERROR:  integer out of range
attendance=# insert into employee
attendance-# values(3,'Sasha Calle','Female',23,1209657387,'scalle@gmail.com');
INSERT 0 1
attendance=# insert into employee
attendance-# values(4,'Clark Kent','Male',33,1230000011,'ckent@yahoo.com');
INSERT 0 1
attendance=# insert into employee
attendance-# values(5,'Lisa Ray','Female',55,0000112234,'lray@yahoo.com');
INSERT 0 1
attendance=# select * from employee;
 employee_id |    name     | gender | age |   mobile   |      email
-------------+-------------+--------+-----+------------+------------------
           1 | Joe Stark   | Male   |  33 | 1234567891 | joe@gmail.com
           2 | Virat Kohli | Male   |  35 | 1290876543 | virat@gmail.com
           3 | Sasha Calle | Female |  23 | 1209657387 | scalle@gmail.com
           4 | Clark Kent  | Male   |  33 | 1230000011 | ckent@yahoo.com
           5 | Lisa Ray    | Female |  55 |     112234 | lray@yahoo.com
(5 rows)


attendance=# insert into Department
attendance-# values (1,'Marketing Department');
INSERT 0 1
attendance=# insert into Department
attendance-# values (2,'Engineering Department'),
attendance-# (3,'Accounting Department');
ERROR:  value too long for type character varying(20)
attendance=# insert into Department
attendance-# values (2,'Engineering Department');
ERROR:  value too long for type character varying(20)
attendance=# insert into Department
attendance-# values (2,'Engineering');
INSERT 0 1
attendance=# insert into Department
attendance-# values (3,'Accounting Dept');
INSERT 0 1
attendance=# insert into Department
attendance-# values (4,'Designing Dept') , (5, 'HR Management');
INSERT 0 2
attendance=# select * from Department;
 dept_id |   department_name
---------+----------------------
       1 | Marketing Department
       2 | Engineering
       3 | Accounting Dept
       4 | Designing Dept
       5 | HR Management
(5 rows)


attendance=# update Department set department_name='Engineering Dept' where dept_id=2;
UPDATE 1
attendance=# select * from Department;'
 dept_id |   department_name
---------+----------------------
       1 | Marketing Department
       3 | Accounting Dept
       4 | Designing Dept
       5 | HR Management
       2 | Engineering Dept
(5 rows)



attendance=# insert into Job_Title
attendance-# values(768,'Creative Director',1);
INSERT 0 1
attendance=# insert into Jon_Title
attendance-# values(832,'Accountant',2),
attendance-# (324,'Production artist',3),
attendance-# (222,'HR Manager',4),
attendance-# (111,'Front-End Developer',5);
ERROR:  relation "jon_title" does not exist
LINE 1: insert into Jon_Title
                    ^
attendance=# insert into Job_Title
attendance-# values(832,'Accountant',2),
attendance-# (324,'Production artist',3),
attendance-# (222,'HR Manager',4),
attendance-# (111,'Front-End Developer',5);
INSERT 0 4
attendance=# select * from Job_Title;
 job_id |      job_title      | dept_id
--------+---------------------+---------
    768 | Creative Director   |       1
    832 | Accountant          |       2
    324 | Production artist   |       3
    222 | HR Manager          |       4
    111 | Front-End Developer |       5
(5 rows)


attendance=# select Department.department_name,Job_Title.job_title
attendance-# from Department
attendance-# INNER JOIN Job_Title
attendance-# ON Department.dept_ID=Job_Title.dept_ID;
   department_name    |      job_title
----------------------+---------------------
 Marketing Department | Creative Director
 Engineering Dept     | Accountant
 Accounting Dept      | Production artist
 Designing Dept       | HR Manager
 HR Management        | Front-End Developer
(5 rows)

attendance=# insert into Duty_Duration
attendance-# values(11,1,768,'08:00:00','17:00:00');
ERROR:  null value in column "date" of relation "duty_duration" violates not-null constraint
DETAIL:  Failing row contains (11, 1, 768, 08:00:00, 17:00:00, null).
attendance=# insert into Duty_Duration
attendance-# values(11,1,768,'08:00:00','17:00:00','01-02-2022');
INSERT 0 1
attendance=# insert into Duty_Duration
attendance-# values(22,2,832,'09:30:00','18:30:00','02-02-2022');
INSERT 0 1
attendance=# insert into Duty_Duration
attendance-# values(33,3,324,'09:27:00','18:30:00','02-02-2022');
INSERT 0 1
attendance=# insert into Duty_Duration
attendance-# values(44,4,222,'09:26:13','18:30:33','01-02-2022');
INSERT 0 1
attendance=# insert into Duty_Duration
attendance-# values(55,5,111,'09:17:23','18:20:40','03-02-2022');
INSERT 0 1
attendance=# select * from Duty_Duration;
 duty_id | employee_id | job_id | start_at |  end_at  |    date
---------+-------------+--------+----------+----------+------------
      11 |           1 |    768 | 08:00:00 | 17:00:00 | 2022-02-01
      22 |           2 |    832 | 09:30:00 | 18:30:00 | 2022-02-02
      33 |           3 |    324 | 09:27:00 | 18:30:00 | 2022-02-02
      44 |           4 |    222 | 09:26:13 | 18:30:33 | 2022-02-01
      55 |           5 |    111 | 09:17:23 | 18:20:40 | 2022-02-03
(5 rows)

attendance=# alter table Leave alter column date drop not null;
ALTER TABLE
attendance=# \d Leave
                  Table "public.leave"
   Column    |  Type   | Collation | Nullable | Default
-------------+---------+-----------+----------+---------
 leave_id    | integer |           | not null |
 employee_id | integer |           | not null |
 job_id      | integer |           | not null |
 date        | date    |           |          |



attendance=# insert into Leave
attendance-# values(8324,1,768);
INSERT 0 1
attendance=# select * from Leave;
 leave_id | employee_id | job_id | date
----------+-------------+--------+------
     8324 |           1 |    768 |
(1 row)


attendance=# insert into Leave
attendance-# values(1879,2,832,'10-02-2022');
INSERT 0 1
attendance=# insert into Leave
attendance-# values(1678,3,324,'16-03-2022');
INSERT 0 1
attendance=# insert into Leave
attendance-# values(1679,4,222,'01-04-2022');
INSERT 0 1
attendance=# insert into Leave
attendance-# values(1700,5,111,'03-02-2022');
INSERT 0 1
attendance=# select * from Leave;
 leave_id | employee_id | job_id |    date
----------+-------------+--------+------------
     8324 |           1 |    768 |
     1879 |           2 |    832 | 2022-02-10
     1678 |           3 |    324 | 2022-03-16
     1679 |           4 |    222 | 2022-04-01
     1700 |           5 |    111 | 2022-02-03
(5 rows)



attendance=# select employee.Name,leave.date
attendance-# from Employee
attendance-# INNER JOIN leave
attendance-# on employee.employee_ID=leave.employee_ID;
    name     |    date
-------------+------------
 Joe Stark   |
 Virat Kohli | 2022-02-10
 Sasha Calle | 2022-03-16
 Clark Kent  | 2022-04-01
 Lisa Ray    | 2022-02-03
(5 rows)


attendance=# select employee.name,duty_duration.start_at,leave.date
attendance-# from employee
attendance-# inner join duty_duration on employee.employee_ID=duty_duration.employee_ID
attendance-# inner join leave on employee.employee_ID=leave.employee_ID;
    name     | start_at |    date
-------------+----------+------------
 Joe Stark   | 08:00:00 |
 Virat Kohli | 09:30:00 | 2022-02-10
 Sasha Calle | 09:27:00 | 2022-03-16
 Clark Kent  | 09:26:13 | 2022-04-01
 Lisa Ray    | 09:17:23 | 2022-02-03
(5 rows)


attendance=# select employee.name,duty_duration.start_at,duty_duration.date
attendance-# from employee
attendance-# INNER JOIN duty_duration on employee.employee_ID=duty_duration.employee_ID;
    name     | start_at |    date
-------------+----------+------------
 Joe Stark   | 08:00:00 | 2022-02-01
 Virat Kohli | 09:30:00 | 2022-02-02
 Sasha Calle | 09:27:00 | 2022-02-02
 Clark Kent  | 09:26:13 | 2022-02-01
 Lisa Ray    | 09:17:23 | 2022-02-03
(5 rows) 


attendance=# alter table leave rename column date to leave_date;
ALTER TABLE

attendance=# select * from leave;
 leave_id | employee_id | job_id | leave_date
----------+-------------+--------+------------
     8324 |           1 |    768 |
     1879 |           2 |    832 | 2022-02-10
     1678 |           3 |    324 | 2022-03-16
     1679 |           4 |    222 | 2022-04-01
     1700 |           5 |    111 | 2022-02-03
(5 rows)


attendance=# alter table attendance_reports
attendance-# add salary int;
ALTER TABLE
attendance=# select * from attendance_reports;
 reprt_id | employee_id | duty_id | job_id | leave_id | date | salary
----------+-------------+---------+--------+----------+------+--------
(0 rows)


attendance=# alter table attendance_reports
attendance-# add total_labor int;
ALTER TABLE



attendance=# insert into attendance_reports
attendance-# values(10003,4,44,222,1679,'2022-02-03',30000,18);
INSERT 0 1
attendance=# select * from attendance_reports;
 report_id | employee_id | duty_id | job_id | leave_id |    date    | salary | total_labor
-----------+-------------+---------+--------+----------+------------+--------+-------------
     10000 |           1 |      11 |    768 |     8324 | 2022-02-03 |  12000 |          18
     10001 |           2 |      22 |    832 |     1879 | 2022-02-03 |  20000 |          19
     10002 |           3 |      33 |    324 |     1678 | 2022-02-03 |  21000 |        19.5
     10003 |           4 |      44 |    222 |     1679 | 2022-02-03 |  30000 |          18
(4 rows)


attendance=# insert into attendance_reports
attendance-# values(10004,5,55,111,1700,'2022-02-03',40000,10);
INSERT 0 1
attendance=# select * from attendance_reports;
 report_id | employee_id | duty_id | job_id | leave_id |    date    | salary | total_labor
-----------+-------------+---------+--------+----------+------------+--------+-------------
     10000 |           1 |      11 |    768 |     8324 | 2022-02-03 |  12000 |          18
     10001 |           2 |      22 |    832 |     1879 | 2022-02-03 |  20000 |          19
     10002 |           3 |      33 |    324 |     1678 | 2022-02-03 |  21000 |        19.5
     10003 |           4 |      44 |    222 |     1679 | 2022-02-03 |  30000 |          18
     10004 |           5 |      55 |    111 |     1700 | 2022-02-03 |  40000 |          10
(5 rows)



attendance=# select employee.name,employee.age,duty_duration.start_at,leave.leave_date
attendance-# from employee
attendance-# INNER JOIN duty_duration ON employee.employee_id=duty_duration.employee_id
attendance-# INNER JOIN leave ON employee.employee_id=leave.employee_id;
    name     | age | start_at | leave_date
-------------+-----+----------+------------
 Joe Stark   |  33 | 08:00:00 |
 Virat Kohli |  35 | 09:30:00 | 2022-02-10
 Sasha Calle |  23 | 09:27:00 | 2022-03-16
 Clark Kent  |  33 | 09:26:13 | 2022-04-01
 Lisa Ray    |  55 | 09:17:23 | 2022-02-03
(5 rows)


#inner join on 4 tables

attendance=# select employee.name,employee.age,employee.email,duty_duration.start_at,leave.leave_date,attendance_reports.salary
attendance-# from employee
attendance-# INNER JOIN duty_duration ON employee.employee_id=duty_duration.employee_id
attendance-# INNER JOIN leave ON employee.employee_id=leave.employee_id
attendance-# INNER JOIN attendance_reports ON employee.employee_id=attendance_reports.employee_id;
    name     | age |      email       | start_at | leave_date | salary
-------------+-----+------------------+----------+------------+--------
 Joe Stark   |  33 | joe@gmail.com    | 08:00:00 |            |  12000
 Virat Kohli |  35 | virat@gmail.com  | 09:30:00 | 2022-02-10 |  20000
 Sasha Calle |  23 | scalle@gmail.com | 09:27:00 | 2022-03-16 |  21000
 Clark Kent  |  33 | ckent@yahoo.com  | 09:26:13 | 2022-04-01 |  30000
 Lisa Ray    |  55 | lray@yahoo.com   | 09:17:23 | 2022-02-03 |  40000
(5 rows)


#to display count with age
attendance=# select count(*),age from employee group by age;
 count | age
-------+-----
     1 |  35
     2 |  33
     1 |  55
     1 |  23
(4 rows)
